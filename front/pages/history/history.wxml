<view class="container">
  <!-- 游戏切换器 -->
  <view class="game-switcher">
    <button class="game-btn {{currentGame === 'ssq' ? 'active' : ''}}" data-game="ssq" bindtap="switchGame">双色球</button>
    <button class="game-btn {{currentGame === 'dlt' ? 'active' : ''}}" data-game="dlt" bindtap="switchGame">大乐透</button>
  </view>

  <!-- 内容切换Tabs -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 'history' ? 'active' : ''}}" data-tab="history" bindtap="switchTab">历史开奖</view>
    <view class="tab-item {{currentTab === 'distribution' ? 'active' : ''}}" data-tab="distribution" bindtap="switchTab">号码分布</view>
    <view class="tab-item {{currentTab === 'missing' ? 'active' : ''}}" data-tab="missing" bindtap="switchTab">数据遗漏</view>
  </view>

  <!-- 历史开奖内容 -->
  <view class="content-section" wx:if="{{currentTab === 'history'}}">
    <view class="history-item" wx:for="{{historyList}}" wx:key="id">
      <view class="period-info">
        <text class="period">第{{item.period}}期</text>
        <text class="date">{{item.date}}</text>
      </view>
      <view class="numbers">
        <text class="number red" wx:for="{{item.redNumbers}}" wx:key="*this">{{item}}</text>
        <text class="number blue" wx:for="{{item.blueNumbers}}" wx:key="*this">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- 号码分布内容 -->
  <view class="content-section" wx:if="{{currentTab === 'distribution'}}">
    <view class="filter-bar">
      <button class="filter-btn {{periodFilter === 10 ? 'active' : ''}}" data-period="10" bindtap="setPeriodFilter">近10期</button>
      <button class="filter-btn {{periodFilter === 30 ? 'active' : ''}}" data-period="30" bindtap="setPeriodFilter">近30期</button>
      <button class="filter-btn {{periodFilter === 50 ? 'active' : ''}}" data-period="50" bindtap="setPeriodFilter">近50期</button>
    </view>
    
    <view class="heatmap-section">
      <view class="heatmap-title">红球热力图</view>
      <view class="heatmap-description">根据出现次数用不同深浅的颜色填充，出现越多颜色越深</view>
      <view class="heatmap-grid">
        <view class="heatmap-item {{item.frequency > 0 ? 'hot' : ''}}" 
              wx:for="{{redHeatmap}}" wx:key="number"
              style="background: linear-gradient(135deg, rgba(255, 71, 87, 0.3), rgba(255, 71, 87, {{item.frequency / maxFrequency}}));">
          {{item.number}}
        </view>
      </view>
    </view>
    
    <view class="heatmap-section">
      <view class="heatmap-title">蓝球热力图</view>
      <view class="heatmap-description">根据出现次数用不同深浅的颜色填充，出现越多颜色越深</view>
      <view class="heatmap-grid">
        <view class="heatmap-item {{item.frequency > 0 ? 'hot' : ''}}" 
              wx:for="{{blueHeatmap}}" wx:key="number"
              style="background: linear-gradient(135deg, rgba(55, 66, 250, 0.3), rgba(55, 66, 250, {{item.frequency / maxFrequency}}));">
          {{item.number}}
        </view>
      </view>
    </view>
    
    <!-- 图表分析 (Chart) -->
    <view class="chart-section">
      <view class="chart-title">号码频率统计</view>
      <view class="chart-description">展示每个号码在选定周期内的出现次数</view>
      <view class="chart-container">
        <view class="chart-item">
          <view class="chart-subtitle">红球频率分布</view>
          <scroll-view scroll-x="true" class="frequency-chart-scroll-view">
            <canvas canvas-id="redFrequencyChart" class="frequency-chart" style="width: 600px; height: 200px;"></canvas>
          </scroll-view>
        </view>
        <view class="chart-item">
          <view class="chart-subtitle">蓝球频率分布</view>
          <scroll-view scroll-x="true" class="frequency-chart-scroll-view">
            <canvas canvas-id="blueFrequencyChart" class="frequency-chart" style="width: 400px; height: 200px;"></canvas>
          </scroll-view>
        </view>
      </view>
    </view>
    
    <!-- 奇偶比统计 -->
    <view class="chart-section">
      <view class="chart-title">奇偶比统计</view>
      <view class="chart-description">以饼图展示选定周期内的号码奇偶分布情况</view>
      <view class="chart-container-horizontal">
        <view class="chart-item-small">
          <view class="chart-subtitle">红球奇偶比</view>
          <canvas canvas-id="redOddEvenChart" class="ratio-chart" style="width: 150px; height: 150px;"></canvas>
        </view>
        <view class="chart-item-small">
          <view class="chart-subtitle">蓝球奇偶比</view>
          <canvas canvas-id="blueOddEvenChart" class="ratio-chart" style="width: 150px; height: 150px;"></canvas>
        </view>
      </view>
    </view>
    
    <!-- 大小比统计 -->
    <view class="chart-section">
      <view class="chart-title">大小比统计</view>
      <view class="chart-description">以饼图展示选定周期内的号码大小分布情况</view>
      <view class="chart-container-horizontal">
        <view class="chart-item-small">
          <view class="chart-subtitle">红球大小比</view>
          <canvas canvas-id="redBigSmallChart" class="ratio-chart" style="width: 150px; height: 150px;"></canvas>
        </view>
        <view class="chart-item-small">
          <view class="chart-subtitle">蓝球大小比</view>
          <canvas canvas-id="blueBigSmallChart" class="ratio-chart" style="width: 150px; height: 150px;"></canvas>
        </view>
      </view>
    </view>
  </view>

  <!-- 数据遗漏内容 -->
  <view class="content-section" wx:if="{{currentTab === 'missing'}}">
    <!-- 期数筛选，与号码分布共用同一个筛选器 -->
    <view class="filter-bar">
      <button class="filter-btn {{periodFilter === 10 ? 'active' : ''}}" data-period="10" bindtap="setPeriodFilter">近10期</button>
      <button class="filter-btn {{periodFilter === 30 ? 'active' : ''}}" data-period="30" bindtap="setPeriodFilter">近30期</button>
      <button class="filter-btn {{periodFilter === 50 ? 'active' : ''}}" data-period="50" bindtap="setPeriodFilter">近50期</button>
    </view>
    
    <view class="missing-section">
      <view class="missing-title">红球遗漏表</view>
      <view class="missing-description">可按任意列排序</view>
      <view class="missing-table">
        <view class="table-header">
          <text class="header-cell sortable" data-type="red" data-column="number" bindtap="sortMissingData">号码</text>
          <text class="header-cell sortable" data-type="red" data-column="theoretical" bindtap="sortMissingData">理论次数</text>
          <text class="header-cell sortable" data-type="red" data-column="count" bindtap="sortMissingData">出现次数</text>
          <text class="header-cell sortable" data-type="red" data-column="lastMissing" bindtap="sortMissingData">上次遗漏</text>
          <text class="header-cell sortable" data-type="red" data-column="currentMissing" bindtap="sortMissingData">本次遗漏</text>
          <text class="header-cell sortable" data-type="red" data-column="maxMissing" bindtap="sortMissingData">最大遗漏</text>
        </view>
        <view class="table-row" wx:for="{{redMissing}}" wx:key="number">
          <text class="table-cell">{{item.number}}</text>
          <text class="table-cell">{{item.theoretical}}</text>
          <text class="table-cell">{{item.count}}</text>
          <text class="table-cell">{{item.lastMissing}}</text>
          <text class="table-cell">{{item.currentMissing}}</text>
          <text class="table-cell">{{item.maxMissing}}</text>
        </view>
      </view>
    </view>
    
    <view class="missing-section">
      <view class="missing-title">蓝球遗漏表</view>
      <view class="missing-description">可按任意列排序</view>
      <view class="missing-table">
        <view class="table-header">
          <text class="header-cell sortable" data-type="blue" data-column="number" bindtap="sortMissingData">号码</text>
          <text class="header-cell sortable" data-type="blue" data-column="theoretical" bindtap="sortMissingData">理论次数</text>
          <text class="header-cell sortable" data-type="blue" data-column="count" bindtap="sortMissingData">出现次数</text>
          <text class="header-cell sortable" data-type="blue" data-column="lastMissing" bindtap="sortMissingData">上次遗漏</text>
          <text class="header-cell sortable" data-type="blue" data-column="currentMissing" bindtap="sortMissingData">本次遗漏</text>
          <text class="header-cell sortable" data-type="blue" data-column="maxMissing" bindtap="sortMissingData">最大遗漏</text>
        </view>
        <view class="table-row" wx:for="{{blueMissing}}" wx:key="number">
          <text class="table-cell">{{item.number}}</text>
          <text class="table-cell">{{item.theoretical}}</text>
          <text class="table-cell">{{item.count}}</text>
          <text class="table-cell">{{item.lastMissing}}</text>
          <text class="table-cell">{{item.currentMissing}}</text>
          <text class="table-cell">{{item.maxMissing}}</text>
        </view>
      </view>
    </view>
  </view>
</view>
